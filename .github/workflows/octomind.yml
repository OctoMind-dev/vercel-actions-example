on:
  deployment_status

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - run: echo "${{ github.event.deployment_status }} ${{ github.head_ref }}"

  octomind:
    if: ${{ github.event.deployment_status.state == 'success' && github.head_ref != '' }}
    name: ðŸš€ trigger octomind e2e tests ðŸš€
    runs-on: ubuntu-latest
    steps:
      - uses: OctoMind-dev/automagically-action-execute@v1
        with:
          url: ${{ github.event.deployment_status.target_url }}
          token: ${{ secrets.AUTOMAGICALLY_TOKEN }}